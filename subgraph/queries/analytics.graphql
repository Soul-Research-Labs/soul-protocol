# PIL Protocol Analytics Queries

## Container Queries

### Get Container by ID
```graphql
query GetContainer($id: ID!) {
  container(id: $id) {
    id
    creator
    status
    createdAt
    consumedAt
    consumer
    sourceChain
    targetChain
    gasUsedCreate
    gasUsedConsume
  }
}
```

### List Recent Containers
```graphql
query RecentContainers($first: Int!, $skip: Int!) {
  containers(
    first: $first
    skip: $skip
    orderBy: createdAt
    orderDirection: desc
  ) {
    id
    creator
    status
    createdAt
    consumedAt
  }
}
```

### Containers by Creator
```graphql
query ContainersByCreator($creator: Bytes!) {
  containers(
    where: { creator: $creator }
    orderBy: createdAt
    orderDirection: desc
  ) {
    id
    status
    createdAt
    consumedAt
    consumer
  }
}
```

### Active Containers Count
```graphql
query ActiveContainers {
  containers(where: { status: ACTIVE }) {
    id
  }
}
```

---

## Analytics Queries

### Daily Statistics
```graphql
query DailyStats($startDate: BigInt!, $endDate: BigInt!) {
  dailyStats(
    where: { date_gte: $startDate, date_lte: $endDate }
    orderBy: date
    orderDirection: asc
  ) {
    id
    date
    containersCreated
    containersConsumed
    proofsVerified
    nullifiersConsumed
    totalGasUsed
    uniqueCreators
    uniqueConsumers
  }
}
```

### Last 7 Days
```graphql
query Last7Days {
  dailyStats(
    first: 7
    orderBy: date
    orderDirection: desc
  ) {
    date
    containersCreated
    containersConsumed
    totalGasUsed
  }
}
```

### Hourly Volume (Last 24h)
```graphql
query HourlyVolume($since: BigInt!) {
  hourlyStats(
    where: { hour_gte: $since }
    orderBy: hour
    orderDirection: asc
  ) {
    hour
    containersCreated
    containersConsumed
    proofsVerified
  }
}
```

---

## User Queries

### User Profile
```graphql
query UserProfile($address: ID!) {
  user(id: $address) {
    address
    firstSeen
    lastSeen
    containersCreated
    containersConsumed
    proofsSubmitted
    nullifiersRegistered
  }
}
```

### Top Users by Containers Created
```graphql
query TopCreators($first: Int!) {
  users(
    first: $first
    orderBy: containersCreated
    orderDirection: desc
  ) {
    address
    containersCreated
    containersConsumed
    firstSeen
    lastSeen
  }
}
```

### Active Users (Last 7 Days)
```graphql
query ActiveUsers($since: BigInt!) {
  users(
    where: { lastSeen_gte: $since }
    orderBy: lastSeen
    orderDirection: desc
  ) {
    address
    containersCreated
    containersConsumed
  }
}
```

---

## Chain Statistics

### All Chain Stats
```graphql
query AllChainStats {
  chainStats(orderBy: totalContainers, orderDirection: desc) {
    chainId
    name
    totalContainers
    activeContainers
    totalProofs
    totalNullifiers
    lastUpdated
  }
}
```

### Chain Comparison
```graphql
query ChainComparison($chains: [Int!]!) {
  chainStats(where: { chainId_in: $chains }) {
    chainId
    name
    totalContainers
    activeContainers
    totalProofs
  }
}
```

---

## Cross-Chain Queries

### Cross-Chain Transfers
```graphql
query CrossChainTransfers(
  $sourceChain: Int
  $targetChain: Int
  $status: TransferStatus
) {
  crossChainTransfers(
    where: {
      sourceChain: $sourceChain
      targetChain: $targetChain
      status: $status
    }
    orderBy: initiatedAt
    orderDirection: desc
  ) {
    id
    sourceChain
    targetChain
    containerId
    initiator
    recipient
    initiatedAt
    completedAt
    status
  }
}
```

### Pending Transfers
```graphql
query PendingTransfers {
  crossChainTransfers(
    where: { status_in: [INITIATED, RELAYED] }
    orderBy: initiatedAt
    orderDirection: asc
  ) {
    id
    sourceChain
    targetChain
    initiator
    initiatedAt
    status
  }
}
```

---

## Nullifier Queries

### Nullifier Lookup
```graphql
query NullifierLookup($hash: Bytes!) {
  nullifiers(where: { nullifierHash: $hash }) {
    id
    nullifierHash
    domain
    registrar
    consumedAt
    txHash
  }
}
```

### Recent Nullifiers
```graphql
query RecentNullifiers($first: Int!) {
  nullifiers(
    first: $first
    orderBy: consumedAt
    orderDirection: desc
  ) {
    id
    nullifierHash
    domain
    consumedAt
  }
}
```

### Domain Stats
```graphql
query DomainStats {
  domains(orderBy: nullifierCount, orderDirection: desc) {
    id
    name
    nullifierCount
    createdAt
  }
}
```

---

## Policy Queries

### Active Policies
```graphql
query ActivePolicies {
  policies(
    where: { isActive: true }
    orderBy: proofCount
    orderDirection: desc
  ) {
    id
    policyHash
    verifier
    registrar
    proofCount
    createdAt
  }
}
```

### Policy Verifications
```graphql
query PolicyVerifications($policyId: ID!) {
  policy(id: $policyId) {
    id
    policyHash
    proofCount
    verifications(orderBy: timestamp, orderDirection: desc) {
      prover
      isValid
      timestamp
      txHash
    }
  }
}
```

---

## Governance Queries

### Active Proposals
```graphql
query ActiveProposals {
  proposals(
    where: { status_in: [PENDING, ACTIVE] }
    orderBy: createdAt
    orderDirection: desc
  ) {
    id
    proposalId
    proposer
    description
    status
    forVotes
    againstVotes
    abstainVotes
    startBlock
    endBlock
  }
}
```

### Proposal Details
```graphql
query ProposalDetails($id: ID!) {
  proposal(id: $id) {
    id
    proposalId
    proposer
    description
    status
    forVotes
    againstVotes
    abstainVotes
    votes {
      voter
      support
      weight
      reason
      timestamp
    }
  }
}
```

### Voter Activity
```graphql
query VoterActivity($voter: Bytes!) {
  votes(
    where: { voter: $voter }
    orderBy: timestamp
    orderDirection: desc
  ) {
    proposal {
      proposalId
      description
      status
    }
    support
    weight
    reason
    timestamp
  }
}
```

---

## Relayer Queries

### Active Relayers
```graphql
query ActiveRelayers {
  relayerStats(
    where: { isActive: true }
    orderBy: successfulRelays
    orderDirection: desc
  ) {
    address
    successfulRelays
    failedRelays
    stakedAmount
    averageRelayTime
    lastRelayAt
  }
}
```

### Relayer Performance
```graphql
query RelayerPerformance($address: ID!) {
  relayerStats(id: $address) {
    successfulRelays
    failedRelays
    totalGasUsed
    averageRelayTime
  }
}
```

---

## Aggregation Queries

### Protocol Overview
```graphql
query ProtocolOverview {
  # Total containers
  containers(first: 1) {
    id
  }
  
  # Active containers
  activeContainers: containers(where: { status: ACTIVE }) {
    id
  }
  
  # Total users
  users(first: 1) {
    id
  }
  
  # Today's stats
  dailyStats(first: 1, orderBy: date, orderDirection: desc) {
    containersCreated
    containersConsumed
    totalGasUsed
    uniqueCreators
  }
}
```

### Gas Analytics
```graphql
query GasAnalytics($days: Int!) {
  dailyStats(
    first: $days
    orderBy: date
    orderDirection: desc
  ) {
    date
    totalGasUsed
    averageGasPerContainer
    containersCreated
  }
}
```
